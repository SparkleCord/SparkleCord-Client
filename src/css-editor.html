<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SparkleCord UserCSS Editor</title>
    <link rel="icon" href="./assets/icons/icon.png">
    <style>
        html, body, #editor {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%
        }
    </style>
</head>
<body>
    <div id="editor"></div>
    <script src="./js/engine.js"></script>
    <script>
        (async () => {
            const script = el("script", { src: "https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js", onload: loadEditor })

            const ed = {
                editor: document.getElementById("editor"),
                config: { value: localStorage.getItem("UserCSS_Backup") || "", language: "css", theme: "vs-dark", automaticLayout: true }
            }

            function loadEditor() {
                require.config({ paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs" } });
                require(["vs/editor/editor.main"], () => {
                    const editor = monaco.editor.create(ed.editor, ed.config);
                    const sync = () => {
                        const css = editor.getValue();
                        localStorage.setItem("UserCSS_Backup", css);
                        window.opener?.postMessage({ type: "cssUpdate", css }, "*");
                    };
                    sync();
                    editor.onDidChangeModelContent(sync);
                });
            }

            document.body.appendChild(script);
        })();
    </script>
</body>
</html>